using System;
using System.Collections.Generic;
using UnityEngine;
using System.Text.RegularExpressions;

[System.Serializable]
public class MathProblem
{
    public string question;
    public int correctAnswer;
    public string solution;
    public int difficulty; // 1-3 (‡∏°.1-‡∏°.3)
    public string topic;
}

[System.Serializable]
public class PlayerProgress
{
    public int totalProblemsAttempted;
    public int correctAnswers;
    public int mathKnowledgeLevel; // 0-100%
    public int accuracyPercentage;
    public Dictionary<string, int> topicMastery;
}

public class MathAI : MonoBehaviour
{
    [Header("AI Configuration")]
    public bool isGeneratingProblem = false;
    public string currentStatus = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå";
    
    [Header("Player Progress")]
    public PlayerProgress playerProgress;
    
    [Header("Problem Settings")]
    private string[] allowedTopics = { "‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£", "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°", "‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô", "‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£" };
    private List<string> forbiddenKeywords = new List<string> 
    { 
        "‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô", "‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°", "‡πÄ‡∏£‡∏Ç‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô", 
        "‡∏ï‡∏£‡∏µ‡πÇ‡∏Å‡∏ì‡∏°‡∏¥‡∏ï‡∏¥", "‡∏•‡∏≠‡∏Å‡∏≤‡∏£‡∏¥‡∏ó‡∏∂‡∏°", "‡∏≠‡∏ô‡∏∏‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏≠‡∏¥‡∏ô‡∏ó‡∏¥‡∏Å‡∏£‡∏±‡∏•",
        "‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå", "‡πÄ‡∏°‡∏ó‡∏£‡∏¥‡∏Å‡∏ã‡πå", "‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô", "‡∏Å‡∏£‡∏≤‡∏ü"
    };
    
    private System.Random random;
    
    void Start()
    {
        random = new System.Random();
        InitializePlayerProgress();
    }
    
    void InitializePlayerProgress()
    {
        playerProgress = new PlayerProgress();
        playerProgress.totalProblemsAttempted = 0;
        playerProgress.correctAnswers = 0;
        playerProgress.mathKnowledgeLevel = 0;
        playerProgress.accuracyPercentage = 0;
        playerProgress.topicMastery = new Dictionary<string, int>();
        
        foreach(string topic in allowedTopics)
        {
            playerProgress.topicMastery[topic] = 0;
        }
    }
    
    public MathProblem GenerateMathProblem()
    {
        StartCoroutine(GeneratingProblemCoroutine());
        
        int difficulty = UnityEngine.Random.Range(1, 4); // ‡∏°.1-‡∏°.3
        MathProblem problem = new MathProblem();
        problem.difficulty = difficulty;
        
        switch(difficulty)
        {
            case 1: // ‡∏°.1
                problem = GenerateGrade7Problem();
                break;
            case 2: // ‡∏°.2
                problem = GenerateGrade8Problem();
                break;
            case 3: // ‡∏°.3
                problem = GenerateGrade9Problem();
                break;
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
        if (!IsValidProblem(problem.question))
        {
            // ‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            SolveAndDeleteInvalidProblem(problem);
            return GenerateMathProblem(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
        }
        
        return problem;
    }
    
    private MathProblem GenerateGrade7Problem()
    {
        MathProblem problem = new MathProblem();
        problem.topic = "‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°";
        problem.difficulty = 1;
        
        int problemType = random.Next(1, 5);
        
        switch(problemType)
        {
            case 1: // ‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏Å‡∏•‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°
                int a = random.Next(-20, 21);
                int b = random.Next(-20, 21);
                problem.question = $"‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á {a} + ({b})";
                problem.correctAnswer = a + b;
                problem.solution = $"{a} + ({b}) = {problem.correctAnswer}";
                break;
                
            case 2: // ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡∏ì‡∏´‡∏≤‡∏£‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°
                int c = random.Next(-10, 11);
                int d = random.Next(1, 11);
                if(c == 0) c = 1;
                problem.question = $"‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á {c} √ó {d}";
                problem.correctAnswer = c * d;
                problem.solution = $"{c} √ó {d} = {problem.correctAnswer}";
                break;
                
            case 3: // ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
                int x = random.Next(1, 21);
                int coefficient = random.Next(2, 6);
                problem.question = $"‡∏ñ‡πâ‡∏≤ x = {x} ‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á {coefficient}x";
                problem.correctAnswer = coefficient * x;
                problem.solution = $"‡πÅ‡∏ó‡∏ô‡∏Ñ‡πà‡∏≤ x = {x} ‡πÑ‡∏î‡πâ {coefficient} √ó {x} = {problem.correctAnswer}";
                break;
                
            case 4: // ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏á‡πà‡∏≤‡∏¢
                int answer = random.Next(1, 16);
                int constant = random.Next(1, 21);
                problem.question = $"‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ x ‡πÉ‡∏ô‡∏™‡∏°‡∏Å‡∏≤‡∏£ x + {constant} = {answer + constant}";
                problem.correctAnswer = answer;
                problem.solution = $"x + {constant} = {answer + constant}\nx = {answer + constant} - {constant}\nx = {answer}";
                break;
        }
        
        return problem;
    }
    
    private MathProblem GenerateGrade8Problem()
    {
        MathProblem problem = new MathProblem();
        problem.topic = "‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô";
        problem.difficulty = 2;
        
        int problemType = random.Next(1, 4);
        
        switch(problemType)
        {
            case 1: // ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö ax + b = c
                int a = random.Next(2, 8);
                int x = random.Next(1, 11);
                int b = random.Next(-15, 16);
                int c = a * x + b;
                problem.question = $"‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ x ‡πÉ‡∏ô‡∏™‡∏°‡∏Å‡∏≤‡∏£ {a}x + ({b}) = {c}";
                problem.correctAnswer = x;
                problem.solution = $"{a}x + ({b}) = {c}\n{a}x = {c} - ({b})\n{a}x = {c - b}\nx = {(c - b)}/{a}\nx = {x}";
                break;
                
            case 2: // ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö ax - b = c
                int a2 = random.Next(3, 7);
                int x2 = random.Next(2, 12);
                int b2 = random.Next(1, 21);
                int c2 = a2 * x2 - b2;
                problem.question = $"‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ x ‡πÉ‡∏ô‡∏™‡∏°‡∏Å‡∏≤‡∏£ {a2}x - {b2} = {c2}";
                problem.correctAnswer = x2;
                problem.solution = $"{a2}x - {b2} = {c2}\n{a2}x = {c2} + {b2}\n{a2}x = {c2 + b2}\nx = {(c2 + b2)}/{a2}\nx = {x2}";
                break;
                
            case 3: // ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏≥
                int totalMarks = random.Next(80, 101);
                int mathMarks = random.Next(40, totalMarks - 20);
                int scienceMarks = totalMarks - mathMarks;
                problem.question = $"‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ {totalMarks} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå {mathMarks} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡πÉ‡∏´‡πâ x ‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå)";
                problem.correctAnswer = scienceMarks;
                problem.solution = $"‡πÉ‡∏´‡πâ x = ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå\n‡∏Ñ‡∏ì‡∏¥‡∏ï + ‡∏ß‡∏¥‡∏ó‡∏¢‡πå = {totalMarks}\n{mathMarks} + x = {totalMarks}\nx = {totalMarks} - {mathMarks}\nx = {scienceMarks}";
                break;
        }
        
        return problem;
    }
    
    private MathProblem GenerateGrade9Problem()
    {
        MathProblem problem = new MathProblem();
        problem.topic = "‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á";
        problem.difficulty = 3;
        
        int problemType = random.Next(1, 4);
        
        switch(problemType)
        {
            case 1: // ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö a(x + b) = c
                int a = random.Next(2, 6);
                int b = random.Next(-8, 9);
                int x = random.Next(1, 11);
                int c = a * (x + b);
                problem.question = $"‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ x ‡πÉ‡∏ô‡∏™‡∏°‡∏Å‡∏≤‡∏£ {a}(x + ({b})) = {c}";
                problem.correctAnswer = x;
                problem.solution = $"{a}(x + ({b})) = {c}\nx + ({b}) = {c}/{a}\nx + ({b}) = {c/a}\nx = {c/a} - ({b})\nx = {c/a - b}";
                break;
                
            case 2: // ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö ax + b = cx + d
                int x2 = random.Next(2, 10);
                int a2 = random.Next(3, 8);
                int c2 = random.Next(1, a2);
                int b2 = random.Next(-15, 16);
                int d2 = a2 * x2 + b2 - c2 * x2;
                problem.question = $"‡∏à‡∏á‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ x ‡πÉ‡∏ô‡∏™‡∏°‡∏Å‡∏≤‡∏£ {a2}x + ({b2}) = {c2}x + {d2}";
                problem.correctAnswer = x2;
                problem.solution = $"{a2}x + ({b2}) = {c2}x + {d2}\n{a2}x - {c2}x = {d2} - ({b2})\n{a2 - c2}x = {d2 - b2}\nx = {(d2 - b2)}/{(a2 - c2)}\nx = {x2}";
                break;
                
            case 3: // ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
                int total = random.Next(50, 101);
                int first = random.Next(10, total - 10);
                int second = total - first;
                problem.question = $"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ {total} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏£‡∏Å‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà {first - second} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏à‡∏á‡∏´‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á (‡πÉ‡∏´‡πâ x ‡πÅ‡∏ó‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á)";
                problem.correctAnswer = second;
                problem.solution = $"‡πÉ‡∏´‡πâ x = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á\n‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏£‡∏Å = x + {first - second}\nx + (x + {first - second}) = {total}\n2x + {first - second} = {total}\n2x = {total} - {first - second}\n2x = {2 * second}\nx = {second}";
                break;
        }
        
        return problem;
    }
    
    private bool IsValidProblem(string question)
    {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤‡∏°
        foreach(string forbidden in forbiddenKeywords)
        {
            if(question.Contains(forbidden))
            {
                return false;
            }
        }
        
        // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°
        return question.Contains("x") || 
               question.Contains("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°") || 
               question.Contains("‡∏™‡∏°‡∏Å‡∏≤‡∏£") ||
               Regex.IsMatch(question, @"-?\d+");
    }
    
    private void SolveAndDeleteInvalidProblem(MathProblem invalidProblem)
    {
        // ‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏Å‡∏≤‡∏£)
        Debug.Log($"[AI AUTO-SOLVE] ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: {invalidProblem.question}");
        Debug.Log($"[AI AUTO-SOLVE] ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: {invalidProblem.correctAnswer}");
        Debug.Log($"[AI AUTO-SOLVE] ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ô‡∏≠‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á...");
        
        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå
        invalidProblem = null;
        System.GC.Collect();
        
        Debug.Log("[AI] ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß");
    }
    
    public void SubmitAnswer(int playerAnswer, MathProblem problem)
    {
        playerProgress.totalProblemsAttempted++;
        
        if(playerAnswer == problem.correctAnswer)
        {
            playerProgress.correctAnswers++;
            playerProgress.topicMastery[problem.topic]++;
            Debug.Log("‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! üéâ");
        }
        else
        {
            Debug.Log($"‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠ {problem.correctAnswer}");
            Debug.Log($"‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥:\n{problem.solution}");
        }
        
        UpdateProgress();
    }
    
    private void UpdateProgress()
    {
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
        if(playerProgress.totalProblemsAttempted > 0)
        {
            playerProgress.accuracyPercentage = 
                (playerProgress.correctAnswers * 100) / playerProgress.totalProblemsAttempted;
        }
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ
        int totalMastery = 0;
        foreach(var mastery in playerProgress.topicMastery.Values)
        {
            totalMastery += mastery;
        }
        
        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ñ‡∏π‡∏Å
        playerProgress.mathKnowledgeLevel = Mathf.Min(100, totalMastery * 5);
        
        DisplayProgress();
    }
    
    public void DisplayProgress()
    {
        Debug.Log("=== ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ===");
        Debug.Log($"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏≤‡∏á‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå: {playerProgress.mathKnowledgeLevel}%");
        Debug.Log($"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: {playerProgress.accuracyPercentage}%");
        Debug.Log($"‡∏ó‡∏≥‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß: {playerProgress.totalProblemsAttempted} ‡∏Ç‡πâ‡∏≠");
        Debug.Log($"‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å: {playerProgress.correctAnswers} ‡∏Ç‡πâ‡∏≠");
        
        Debug.Log("\n--- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ---");
        foreach(var topic in playerProgress.topicMastery)
        {
            int masteryLevel = Mathf.Min(100, topic.Value * 10);
            Debug.Log($"{topic.Key}: {masteryLevel}%");
        }
    }
    
    private System.Collections.IEnumerator GeneratingProblemCoroutine()
    {
        isGeneratingProblem = true;
        currentStatus = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...";
        yield return new WaitForSeconds(1f);
        
        currentStatus = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á...";
        yield return new WaitForSeconds(0.5f);
        
        currentStatus = "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!";
        yield return new WaitForSeconds(0.5f);
        
        isGeneratingProblem = false;
        currentStatus = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå";
    }
    
    void OnGUI()
    {
        GUILayout.BeginArea(new Rect(10, 10, 300, 200));
        
        GUILayout.Label($"‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ AI: {currentStatus}");
        
        if(!isGeneratingProblem && GUILayout.Button("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÉ‡∏´‡∏°‡πà"))
        {
            MathProblem newProblem = GenerateMathProblem();
            Debug.Log($"‡πÇ‡∏à‡∏ó‡∏¢‡πå: {newProblem.question}");
            Debug.Log($"‡∏£‡∏∞‡∏î‡∏±‡∏ö: ‡∏°.{newProblem.difficulty}");
        }
        
        GUILayout.Space(10);
        GUILayout.Label("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤:");
        GUILayout.Label($"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ: {playerProgress.mathKnowledgeLevel}%");
        GUILayout.Label($"‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥: {playerProgress.accuracyPercentage}%");
        
        GUILayout.EndArea();
    }
}